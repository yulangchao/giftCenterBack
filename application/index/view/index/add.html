<style>
    .el-upload__input {
        visibility: hidden;
    }
    .upload-demo .el-upload--picture {
        width: 100%;
    }
    .upload-demo .el-button {
        float: left;
    }

    .w-e-toolbar {
        overflow: -webkit-paged-x;
    }
</style>
<div id="app">
    <el-row :gutter="10">
        <el-form
            :rules="rules"
            ref="dataForm"
            :model="temp"
            label-position="left"
            label-width="100px"
            style="max-width: 600px; width: 90vw; margin:auto;"
        >
            <el-form-item label="标题" prop="title">
                <el-input v-model="temp.title"></el-input>
            </el-form-item>
            <el-form-item label="地址" prop="address">
                <el-input
                    v-model="temp.address"
                    id="customer_address"
                ></el-input>
            </el-form-item>
            <el-form-item label="联系电话">
                <el-input v-model="temp.first_contact_phone"></el-input>
            </el-form-item>

            <!--
                <el-form-item :label="$t('table.category')">
                    <el-select class="filter-item" v-model="temp.category" placeholder="Please select">
                        <el-option v-for="item in category_list" :key="item.key" :label="$t('category.'+item.key)" :value="item.key">

                        </el-option>
                    </el-select>
                </el-form-item>
            -->

            <el-form-item label="详情">
                <div class="editor"></div>
            </el-form-item>

            <el-upload
                class="upload-demo"
                action="/index/ajax/upload"
                accept="image/*"
                multiple
                :on-preview="handlePreview"
                :on-success="handleUpload"
                :on-remove="handleRemove"
                :file-list="fileList2"
                list-type="picture"
            >
                <el-button size="small" type="primary">上传图片</el-button>
                <div slot="tip" class="el-upload__tip"></div>
            </el-upload>
            <br />
            <el-row>
                <el-button @click="location.href='/'">返回</el-button>
                <el-button type="primary" @click="createData">提交</el-button>
            </el-row>
        </el-form>
    </el-row>
</div>
<script>
    function initAutocomplete() {
        var cityBounds = new google.maps.LatLngBounds(
            new google.maps.LatLng(49.006663, -123.30771),
            new google.maps.LatLng(49.395186, -122.187598)
        );

        var input = document.getElementById("customer_address");
        var options = {
            bounds: cityBounds,
            componentRestrictions: { country: "ca" }
        };

        var searchBox = new google.maps.places.Autocomplete(input, options);

        // [START region_getplaces]
        // Listen for the event fired when the user selects a prediction and retrieve
        // more details for that place.
        google.maps.event.addListener(searchBox, "place_changed", () => {
            var place = searchBox.getPlace();
            app.temp.address = place.formatted_address;
            lat = place.geometry.location.lat();
            lng = place.geometry.location.lng();
            if (location.pathname.indexOf("Admin/TotalOrder/map") > -1) {
                showPosition(lat, lng);
            }
        });
    }

    var app = new Vue({
        el: "#app",
        data() {
            return {
                dialogFormVisible: true,
                fileList2: [],
                temp: {
                    id: undefined,
                    title: "",
                    address: "",
                    detail: "1",
                    images: [],
                    phone: "",
                    lat: "",
                    lng: "",
                    city_name: ""
                },
                rules: {
                    title: [
                        {
                            required: true,
                            message: "title is required",
                            trigger: "change"
                        }
                    ]
                    // address: [
                    //     {
                    //         required: true,
                    //         message: "地址是必须的",
                    //         trigger: "blur"
                    //     }
                    // ]
                }
            };
        },
        mounted() {},
        methods: {
            handleUpload(res, file, fileList) {
                if (res.code) {
                    this.temp.images.push(file);
                }
            },
            handleRemove(file, fileList) {
                var index = this.temp.images.indexOf(file);
                this.temp.images.splice(index, 1);
            },
            handlePreview(file) {
                console.log(file);
            },
            createData() {
                this.$refs["dataForm"].validate(valid => {
                    if (valid) {
                        axios
                            .post(
                                "/index/index/add",
                                JSON.stringify(this.temp)
                            )
                            .then(response => {
                                console.log(response);
                            });
                    }
                });
            }
        }
    });
</script>
<script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDaINsjiL1DTKKjZneaPTvZQj6HTYZiGOU&libraries=places&language=en&callback=initAutocomplete"
    async
    defer
></script>
